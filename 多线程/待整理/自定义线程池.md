# 线程池

版本一：

提交任务

关闭线程池



版本二：

增加拒绝策略，当任务数目达到一定的数量就拒绝

停止线程池，需要等任务执行完毕



版本三：

忙式自动扩充线程数目，闲时减少线程数目



# 开始之前的思考

**为什么要用线程池？**

1. 降低资源消耗。通过重复利用已创建的线程，降低线程创建和销毁造成的消耗
2. 提高响应速度。当任务到达时，任务无需等待线程创建完毕，直接使用线程池里的线程
3. 



**设计一个线程池需要包括哪些组件？**

1）一个存放提交给线程池任务的容器，任务队列

2）一个存放工作者线程的容器，线程队列



**工作原理**：

生产者消费者模式

1）线程循环 从任务队列中取任务，并执行

2）若任务队列为空，线程需要在任务队列上等待(wait)

3）若有任务新增到队列中，需要唤醒(notify)在任务队列上等待的线程

4）取任务、提交任务涉及到对共享变量任务队列的并发读写，需要考虑线程安全问题



# 学习JUC中的线程池

- **corePoolSize和maximumPoolSize**

  ![ThreadPoolExecutor](image/ThreadPoolExecutor.jpg)

- **Keep-alive times**

  如果当前线程数大于corePoolSize，超额的线程会在空闲Keep-alive times之后终止

- **拒绝策略**

  两种情况：

  （1）当任务队列已满，并且线程数到达maximumPoolSize，那么执行拒绝策略

  （2）线程池已经关闭

- 