参考资料：

[JVM内存结构 VS Java内存模型 VS Java对象模型](https://www.hollischuang.com/archives/2509)

[再有人问你Java内存模型是什么，就把这篇文章发给他。](https://www.hollischuang.com/archives/2550)





# JVM内存结构 

**Java虚拟机规范划分为**

- Java虚拟机栈
- 本地方法栈
- PC寄存器
- 堆
- 方法区（包含运行时常量池）

上面只是规范，具体的虚拟机实现会有所不同，但大致相同







# Java内存模型 

## 是什么

- Java内存模型规定了所有的变量都存储在主内存中（这里的变量不包括局部变量，局部变量是线程私有的，不存在竞争问题）
- 每条线程还有自己的工作内存，线程的工作内存中保存了该线程中是用到的变量的主内存副本拷贝，线程对变量的所有操作都必须在工作内存中进行，而不能直接读写主内存。
- 不同的线程之间也无法直接访问对方工作内存中的变量，线程间变量的传递均需要自己的工作内存和主存之间进行数据同步进行。

- 而JMM就作用于**工作内存和主存之间数据同步过程**。规定了如何做数据同步以及什么时候做数据同步。

![Java内存模型](image/Java内存模型.png)



## 总结Java内存模型

JMM是一种规范，目的是解决由于多线程通过共享内存进行通信时，存在的本地内存数据不一致、编译器会对代码指令重排序、处理器会对代码乱序执行等带来的问题。



## Java内存模型的实现

- Java内存模型是一个规范
- 在Java中提供了一系列和并发处理相关的关键字，比如`volatile`、`synchronized`、`final`、`concurren`包等。这些就是Java内存模型封装了底层的实现后提供给程序员使用的一些关键字。



> **补充**
>
> 1. 为什么需要指令重排？
>
> 答：为了使处理器内部的运算单元能被充分利用
>





